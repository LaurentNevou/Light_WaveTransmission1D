%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%% AR coating structure %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

nL=1;
nR=3;

l1=3e-6;
n1=1;
l3=5e-6;
n3=3;

n2=1.732+0.0i;  % sqrt(n3)

lambda0=850e-9;      % Central wavelength

l2=lambda0/(4*abs(n2));   % thickness at lambda/4

%alpha2=4*pi*imag(n2)./lambda;


layer=[
l1   n1
l2   n2
l3   n3
];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%% Formula computation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

r12 = (n1-n2) / (n1+n2);
r23 = (n2-n3) / (n2+n3);

t12 = 2*n1 / (n1+n2);
t23 = 2*n2 / (n2+n3);


D1 = zeros(2,2,length(lambda));

D1(1,1,:) = exp(+1i*2*pi*n2*l2./lambda) ;
D1(2,2,:) = exp(-1i*2*pi*n2*l2./lambda) ;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

P1(1,1,:) = (1./t12)  ;
P1(1,2,:) = (1./t12) .*  r12 ;
P1(2,1,:) = (1./t12) .*  r12 ;
P1(2,2,:) = (1./t12)  ;

P2(1,1,:) = (1./t23)  ;
P2(1,2,:) = (1./t23) .*  r23 ;
P2(2,1,:) = (1./t23) .*  r23 ;
P2(2,2,:) = (1./t23)  ;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for j=1:length(lambda)
    S(:,:,j)=P1*D1(:,:,j)*P2;
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Rf = (   abs(   S(1,2,:)./S(2,2,:)  )   ).^2;
Rf = reshape(Rf,1,length(lambda));

Tf = abs( 1./S(2,2,:) ).^2 ;
Tf = real(n3./n1).*reshape(Tf,1,length(lambda));

Af=1-exp(-4*pi*imag(n2)./lambda * l2);



