%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% FabryPerot Cavity structure %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

nL=1;
nR=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fabri-Perot cavity 

n1=1;
n2=3.6;
lambda0=940e-9;      % Central wavelength
l1=1e-6;
l2=10*lambda0/(2*abs(n2));

alpha2=4*pi*imag(n2)./lambda;

layer=[
l1   n1
l2   n2
l1   n1
];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

RR = ((n2-n1)/(n1+n2))^2;

TT = 1-RR;
%TT = 2*n1/(n1+n2) * 2*n2/(n1+n2);

theta=pi;
phi=2*pi*n2*l2./lambda;

delta=2*(phi-theta);

Tfp = abs(TT).^2 ./( 1 + abs(RR)^2*exp(-2*imag(delta)) - 2*abs(RR)*exp(-imag(delta)).*cos(real(delta))  );

Tfp = Tfp.*exp(-alpha2*l2);

Tf=Tfp;
Rf=1-Tf;